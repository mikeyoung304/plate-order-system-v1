{% extends "layouts/base.html" %}

{% block title %}Server View - Plate Order System<script src="{{ url_for('static', filename='js/improved-ipad-voice-recognition.js') }}"></script>
{% endblock %}

{% block meta_description %}Server view for voice-enabled ordering in assisted living facilities<script src="{{ url_for('static', filename='js/improved-ipad-voice-recognition.js') }}"></script>
{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/server-view.css') }}">
<script src="{{ url_for('static', filename='js/improved-ipad-voice-recognition.js') }}"></script>
{% endblock %}

{% block content %}
<div class="server-view-container">
    <div class="row">
        <!-- Floor Plan Section -->
        <div class="floor-plan-container card shadow-lg">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="m-0">Floor Plan</h2>
                <div class="zoom-controls">
                    <button id="zoom-out-btn" class="btn btn-sm btn-outline" aria-label="Zoom out">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button id="zoom-in-btn" class="btn btn-sm btn-outline" aria-label="Zoom in">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="card-body p-0 position-relative">
                <div id="floor-plan" class="floor-plan">
                    <!-- Tables will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Order Section -->
        <div class="order-container card shadow-lg">
            <div class="card-header">
                <h2 class="m-0">Table <span id="selected-table-number">--</span></h2>
            </div>
            <div class="card-body">
                <div id="table-not-selected" class="text-center py-5">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-3 text-neutral-400">
                        <path d="M3 6H21M3 12H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p class="text-neutral-600">Please select a table to place an order</p>
                </div>

                <div id="table-selected" class="hidden">
                    <div class="voice-recorder-container text-center mb-4">
                        <p class="mb-3">Press and hold the button to record the order</p>
                        <button id="record-button" class="voice-button" aria-label="Record voice order">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 1C11.2044 1 10.4413 1.31607 9.87868 1.87868C9.31607 2.44129 9 3.20435 9 4V12C9 12.7956 9.31607 13.5587 9.87868 14.1213C10.4413 14.6839 11.2044 15 12 15C12.7956 15 13.5587 14.6839 14.1213 14.1213C14.6839 13.5587 15 12.7956 15 12V4C15 3.20435 14.6839 2.44129 14.1213 1.87868C13.5587 1.31607 12.7956 1 12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M19 10V12C19 13.8565 18.2625 15.637 16.9497 16.9497C15.637 18.2625 13.8565 19 12 19C10.1435 19 8.36301 18.2625 7.05025 16.9497C5.7375 15.637 5 13.8565 5 12V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 19V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 23H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <p id="record-status" class="mt-2 text-neutral-600">Press and hold to record</p>
                        
                        <!-- Audio visualizer -->
                        <div id="audio-visualizer" class="audio-visualizer hidden mt-4"></div>
                    </div>
                    
                    <div id="transcription-result" class="hidden mt-4 p-4 bg-neutral-50 rounded-lg">
                        <h3 class="font-semibold text-neutral-800 mb-2">Order Details:</h3>
                        <p id="transcription-text" class="text-neutral-700 mb-4 whitespace-pre-line"></p>
                        <div class="d-flex justify-content-end">
                            <button id="submit-order-btn" class="btn btn-success">
                                Submit Order
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Voice Recorder Modal -->
<div id="voice-recorder-modal" class="modal hidden" role="dialog" aria-labelledby="voice-recorder-modal-title">
    <div class="modal-overlay"></div>
    <div class="modal-container">
        <div class="modal-header">
            <h3 id="voice-recorder-modal-title" class="modal-title">Record Order</h3>
            <button class="modal-close" aria-label="Close modal">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="voice-recorder-container text-center">
                <button id="modal-record-button" class="voice-button" aria-label="Record voice order">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 1C11.2044 1 10.4413 1.31607 9.87868 1.87868C9.31607 2.44129 9 3.20435 9 4V12C9 12.7956 9.31607 13.5587 9.87868 14.1213C10.4413 14.6839 11.2044 15 12 15C12.7956 15 13.5587 14.6839 14.1213 14.1213C14.6839 13.5587 15 12.7956 15 12V4C15 3.20435 14.6839 2.44129 14.1213 1.87868C13.5587 1.31607 12.7956 1 12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M19 10V12C19 13.8565 18.2625 15.637 16.9497 16.9497C15.637 18.2625 13.8565 19 12 19C10.1435 19 8.36301 18.2625 7.05025 16.9497C5.7375 15.637 5 13.8565 5 12V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 19V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 23H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <p id="modal-record-status" class="mt-2 text-neutral-600">Press and hold to record</p>
                
                <!-- Audio visualizer -->
                <div id="modal-audio-visualizer" class="audio-visualizer hidden mt-4"></div>
            </div>
            
            <div id="modal-transcription-result" class="hidden mt-6 p-4 bg-neutral-50 rounded-lg">
                <h5 class="font-semibold text-neutral-800 mb-2">Transcription:</h5>
                <p id="modal-transcription-text" class="text-neutral-700 mb-4 whitespace-pre-line"></p>
                <div class="d-flex justify-content-end space-x-2">
                    <button id="retry-recording-btn" class="btn btn-outline">
                        Retry
                    </button>
                    <button id="confirm-order-btn" class="btn btn-success">
                        Confirm Order
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification Component -->
<div id="notification" class="notification notification-success" style="display: none;">
    <div class="notification-content">
        <div class="notification-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <div class="notification-text">
            <h4 class="notification-title">Success</h4>
            <p class="notification-message">Order submitted successfully!</p>
        </div>
        <button id="notification-close" class="notification-close" aria-label="Close notification">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>
</div>
<script src="{{ url_for('static', filename='js/improved-ipad-voice-recognition.js') }}"></script>
{% endblock %}

{% block scripts %}
<!-- Import the VoiceRecorder component -->
<script src="{{ url_for('static', filename='js/components/voice/VoiceRecorder.js') }}"></script>

<!-- Import the server-view.js script -->
<script src="{{ url_for('static', filename='js/pages/server-view.js') }}"></script>
<script src="{{ url_for('static', filename='js/improved-ipad-voice-recognition.js') }}"></script>
{% endblock %}
